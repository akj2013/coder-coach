#  üß± Jobs - build
#    buildÎäî ÌïòÎÇòÏùò Job Ïù¥Î¶ÑÏúºÎ°ú, ÏïàÏóêÎäî Ïó¨Îü¨ Îã®Í≥Ñ(Step)Í∞Ä ÏûàÏäµÎãàÎã§. Í∞ÅÍ∞Å ÏàúÏÑúÎåÄÎ°ú Ïã§ÌñâÎê©ÎãàÎã§.
#
#    1. ‚úÖ Set up job
#    GitHub ActionsÍ∞Ä ÎπåÎìúÎ•º ÏúÑÌïú **Îü∞ÌÉÄÏûÑ ÌôòÍ≤Ω (Í∞ÄÏÉÅ Î®∏Ïã†)**ÏùÑ ÏÑ∏ÌåÖÌï©ÎãàÎã§.
#
#  Ïòà: Ubuntu, Java ÏÑ§Ïπò ÌôòÍ≤Ω Îì± Ï¥àÍ∏∞ ÏÑ∏ÌåÖÏùÑ Ìè¨Ìï®Ìï©ÎãàÎã§.
#
#    2. ‚úÖ Run actions/checkout@v3
#    **ÏΩîÎìúÎ•º GitHub RepositoryÏóêÏÑú checkout(Îã§Ïö¥Î°úÎìú)**Ìï©ÎãàÎã§.
#
#    ÎπåÎìú/ÌÖåÏä§Ìä∏Î•º ÏúÑÌï¥ ÏÜåÏä§ÏΩîÎìúÎ•º Î°úÏª¨ Î®∏Ïã†Ïóê Í∞ÄÏ†∏ÏòµÎãàÎã§.
#
#    3. ‚úÖ Run actions/setup-java@v3
#    Java Í∞úÎ∞ú ÌôòÍ≤Ω ÏÑ§Ï†ï Îã®Í≥ÑÏûÖÎãàÎã§.
#
#    .java-version, build.gradle.kts, .tool-versions Îì±Ïùò ÏÑ§Ï†ïÏóê Îî∞Îùº OpenJDK ÎòêÎäî ÏßÄÏ†ïÌïú Î≤ÑÏ†ÑÏùÑ ÏÑ§ÏπòÌï©ÎãàÎã§.
#
#    MavenÏù¥ÎÇò GradleÏù¥ Java Í∏∞Î∞òÏù¥ÎØÄÎ°ú ÌïÑÏàòÏûÖÎãàÎã§.
#
#    4. ‚úÖ Grant execute permission for gradlew
#    bash
#    Î≥µÏÇ¨
#    Ìé∏Ïßë
#    chmod +x ./gradlew
#    gradlew Ïä§ÌÅ¨Î¶ΩÌä∏Ïóê Ïã§Ìñâ Í∂åÌïúÏùÑ Î∂ÄÏó¨Ìï©ÎãàÎã§ (Unix/Linux ÌôòÍ≤ΩÏóêÏÑú ÌïÑÏàò).
#
#    gradlewÎäî Gradle WrapperÎ°ú, CI ÌôòÍ≤ΩÏóêÏÑúÎèÑ Î°úÏª¨ ÏÑ§Ïπò ÏóÜÏù¥ ÎπåÎìú Í∞ÄÎä•ÌïòÍ≤å Ìï¥ Ï§çÎãàÎã§.
#
#    5. ‚úÖ Build with Gradle
#    bash
#    Î≥µÏÇ¨
#    Ìé∏Ïßë
#    ./gradlew build
#    ÌÖåÏä§Ìä∏ Ìè¨Ìï®Ìïú Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ ÎπåÎìúÎ•º ÏàòÌñâÌï©ÎãàÎã§.
#
#    testÎèÑ Ïù¥ Îã®Í≥ÑÏóêÏÑú ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÎêòÎ©∞, Ïã§Ìå® Ïãú JobÏù¥ Ï§ëÎã®Îê©ÎãàÎã§.
#
#    application.yml ÏÑ§Ï†ïÏù¥ Ï†úÎåÄÎ°ú ÎêòÏñ¥ ÏûàÏóàÍ∏∞ ÎïåÎ¨∏Ïóê ÏÑ±Í≥µÌïú Í≤É.
#
#    6. ‚úÖ Post Run actions/setup-java@v3
#    ÏûêÎ∞î ÏÑ§Ï†ï ÌõÑÏùò Ï†ïÎ¶¨(Post step) ÏûëÏóÖÏûÖÎãàÎã§.
#
#    ÏûÑÏãúÎ°ú ÏÑ§ÏπòÎêú Ï∫êÏãú Ï†ïÎ¶¨, ÌôòÍ≤Ω Î≥ÄÏàò Ï†ïÎ¶¨ Îì±ÏùÑ Ìè¨Ìï®Ìï† Ïàò ÏûàÏäµÎãàÎã§.
#
#    7. ‚úÖ Post Run actions/checkout@v3
#    Git checkout Ïù¥ÌõÑÏùò Ï†ïÎ¶¨(Post step).
#
#    Î≥¥ÌÜµÏùÄ ÏûÑÏãú Git ÏÑ§Ï†ïÏù¥ÎÇò workspace cleanupÏùÑ Ìè¨Ìï®Ìï©ÎãàÎã§.
#
#    8. ‚úÖ Complete job
#    Ï†ÑÏ≤¥ ÎπåÎìú ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä Ï†ïÏÉÅ Ï¢ÖÎ£åÎêòÏóàÏùåÏùÑ ÎÇòÌÉÄÎÉÖÎãàÎã§.

  # ÏõåÌÅ¨ÌîåÎ°úÏö∞Ïùò Ïù¥Î¶Ñ ÏßÄÏ†ï
name: CI/CD

# ÏõåÌÅ¨ÌîåÎ°úÏö∞Í∞Ä ÏãúÏûëÎê† Ï°∞Í±¥ ÏßÄÏ†ï
on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest # Ïã§Ìñâ ÌôòÍ≤Ω ÏßÄÏ†ï
    # Ïã§Ìñâ Ïä§ÌÖù ÏßÄÏ†ï
    steps:
      - uses: actions/checkout@v3 # GitHub Ï†ÄÏû•ÏÜåÏùò ÏÜåÏä§ ÏΩîÎìúÎ•º CI ÏÑúÎ≤ÑÎ°ú Ï≤¥ÌÅ¨ÏïÑÏõÉ (clone) Ìï©ÎãàÎã§.

      - uses: actions/setup-java@v3 # ÏûêÎ∞î Í∞úÎ∞ú ÌôòÍ≤ΩÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§. Zulu Î∞∞Ìè¨ÌåêÏùò Java 17ÏùÑ ÏÑ§ÏπòÌï©ÎãàÎã§.
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Grant execute permission for gradlew # gradlew Ïã§Ìñâ Í∂åÌïú Î∂ÄÏó¨
        run: chmod +x gradlew # gradlew Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùºÏóê Ïã§Ìñâ Í∂åÌïúÏùÑ Î∂ÄÏó¨Ìï©ÎãàÎã§ (Î¶¨ÎàÖÏä§ÏóêÏÑú ÌïÑÏöî).

      - name: Build with Gradle # GradleÏùÑ ÏÇ¨Ïö©Ìï¥ ÌîÑÎ°úÏ†ùÌä∏Î•º ÌÅ¥Î¶∞ ÌõÑ ÎπåÎìúÌï©ÎãàÎã§.
        run: ./gradlew clean build # clean: Í∏∞Ï°¥ ÎπåÎìú Í≤∞Í≥ºÎ¨º Ï†úÍ±∞ / build: ÏÉàÎ°ú ÎπåÎìú Ïã§Ìñâ (Ïª¥ÌååÏùº + ÌÖåÏä§Ìä∏ Ìè¨Ìï®)

      - name: Get current time # ÌòÑÏû¨ÏãúÍ∞Ñ Í∞ÄÏ†∏Ïò§Í∏∞
        uses: josStorer/get-current-time@/v2.0.2
        id: current-time
        with:
          format: YYYY-MM-DDTHH-mm-ss
          utcOffset: "+09:00"

      - name: Set artifact # Î∞∞Ìè¨Ïö© Ìå®ÌÇ§ÏßÄ Í≤ΩÎ°ú Ï†ÄÏû•
        run: echo "artifact=$(ls ./build/libs)" >> $GITHUB_ENV

      - name: Beanstalk Deploy # ÎπàÏä§ÌÜ†ÌÅ¨ Î∞∞Ìè¨
        uses: einaregilsson/beanstalk-deploy@v20
        with:
            aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
            aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
            applictaion_name: coder-coach
            environment_name: coder-coach-env
            version-label: github-action-${{ steps.current-time.outputs.formattedTime }}
            region: ap-northeast-1
            deployment_package: ./build/libs/${{ env.artifact }}